-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
　【改変版 SSAO エフェクト v0.5a】

　　配布者：おたもん（user/5145841）　mail:o_tamon@okoneya.mail-box.ne.jp 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

■ はじめに
　このエフェクトは mqdl さんの SSAO エフェクトをちょっとだけ改変した物です。
　自分の公開エフェクトの透明化対応に合わせて、自分の必須エフェクトも対応してもらいました。

　アルゴリズムをちゃんと理解せずにお手軽透明化対応ですので不具合がある可能性があります。ご注意ください。

　＊　注　意　＊
　MikuMikuMoving と AMD Radeon HD との組み合わせに置いて解像度が下がるという不具合が有ります。
　これは o_SSAO だけではなく Mogg さんが MMM 用に移植したバージョンでも発生する現象です。


■ 概要
　SSAO(Screen Space Ambient Occlusion)を MMD に加える MME のポストエフェクトです。
　スクリーン上の情報を完全な3D空間ではなく、2.5D上で計算することで
　擬似的なアンビエントオクルージョン効果が得られます。

　ピクセルシェーダ3.0必須。
　比較的大きなビデオメモリを使用するので、VRAM 512MB 以上のビデオカードを推奨します。

■ 透明度対応について
　元々このエフェクトは基本的にステージやスカイドームを使用した非透過な動画に対して使われるのを
　想定していますが、fx ファイルの先頭にある「#define NON_TRANSPARENT」に続く数字を
　1 から 0 に変えることで透明度を保持したまま出力できるようになります。

 ＊　ご注意　＊
　・仕様により透明度有効時に MMD のプレビューなどの透明度を無視する場面では透明部分との境目が汚く見えます。
　・MMD の仕様なのか透明度有効で出力した場合、半透明部分が正しい色で表示されません。
　・AVI 出力の際は Ut Video Codec RGBA(ULRA)などの透明度に対応したコーデックをご使用ください。
　・PNG で画像保存する場合や RGBA 系コーデックで AVI 出力する時だけ有効にしてください。

■ 入っているもの
　・o_SSAO.fx
　　　MMD で SSAO を表現するための MME ポストエフェクトです。

　・o_SSAO_HQ.fx
　　　各処理を高精度に行うことで滑らかかつボケにくくした SSAO エフェクトです。
　　　特に輪郭の誤判定が格段に減ってますがその分重くなっているのでご注意ください。

　・o_SSAO.x
　・o_SSAO_HQ.x
　　　MMD で上記フィルタを使うためのアクセサリファイル。

　・DepthMap.fx
　・Exclusion.fx
　・NormalMap.fx
　　　SAO の為に使われるオフスクリーンターゲットを描画するためのエフェクトです。

　・readme.txt
　　　このファイル。はじめにお読みください。


■ 使い方
  MikuMikuEffect が使える状態の MikuMikuDance にアクセサリ o_SSAO.x を追加してください。
  アクセサリの描画順の影響をうけますのでいろいろと入れ替えてみると面白いかもしれません。

 ・アクセサリ操作で設定できるもの（MikuMikuEffect）
    Si：エフェクトの影濃度を設定します。mqdl さんのオリジナルと同じ濃さにするには「2.0」を指定します。
    テクスチャに影が描かれているモデルなどでは「0.5」以下の小さい数字がおすすめです。

    Tr：エフェクトの MMD 最適化率を設定します。小さくすると本来の SSAO エフェクトに近づきます。

    ＊　おまけ　＊
    X ：fx ファイルで指定するパラメータ strength（隠蔽判定１）を微調整します。（X ＞ -1.0）
    Y ：fx ファイルで指定するパラメータ falloff（隠蔽判定２）を微調整します。（Y ＞ -1.0）
    Z ：fx ファイルで指定するパラメータ blur（ぼかし量）を微調整します。（1.0 ＞ Z ＞ -1.0）

 ・パラメータコントロール欄で設定できるもの（MikuMikuEffect）
    影のみ描画：OFF で通常表示、ON でSSAO影のみ表示
    影濃度：エフェクトの影濃度を設定します。アクセサリ操作の Si はこの値を Si 倍します。
            mqdl さんのオリジナル相当は「20.0」、おたもん的には「2.0」ぐらいがオススメです。

    判定強度：影判定量を設定します。アクセサリ操作の X はこの値を(X+1.0)倍します。
              mqdl さんのオリジナル相当は「0.01」、おたもん的には「0.004」ぐらいがオススメです。
    判定減衰度：影判定量を設定します。アクセサリ操作の Y はこの値を(Y+1.0)倍します。
    MMD最適化度：SSAO 影の MMD 最適化率を設定します。アクセサリ操作の Tr と掛けた値が最終値になります。
    ボカし幅：影点を滑らかにするためのボカし幅を設定します。アクセサリ操作の Z はこの値を(Z+1.0)倍します。

    半径：SSAO 影判定半径を設定します。
    エッジ判定値：面方向によるエッジ判定を行う際のしきい値を設定します。調整すると誤判定が改善されるかもしれません。
    深度判定値（o_SSAO HQのみ）：奥行によるエッジ判定を行う際のしきい値を設定します。調整すると誤判定が改善s（ry

 ・エフェクトファイルの書き換えで設定できるもの
    NON_TRANSPARENT：0 で背景を透過処理（初期値）、1 に設定すると背景を白ベタにして透過しません。
    　　　　　　　　 編集中は 1 に設定しておいて、RGBA 出力時だけ 0 にすると背景画像を用意したりする必要がなくなります。

    ShowSHADOW：0 で普通にエフェクトを適用（初期値）、1 で SSAO 影だけを表示します。
    　　　　　　アクセサリ操作などでパラメータの調整を行うときに 1 にすると調整がしやすくなります。

    ＊ o_SSAO HQ のみ
    usePostAntiAlias： 1 でエッジ部分に 1-PASS DLAA というポストアンチエイリアス処理を行います。（初期値）
　　　　　　　　　 0 で同処理を行いません。エッジ部分が若干ガタツキますが有効では重い場合などにご使用ください。

    　その他のパラメータに関しては各 fx ファイル内の mqdl さんの解説をご覧ください。

    ＊　知って得する小技　＊
    特定のモデルや材質だけに SSAO を掛けたくない場合は MMEffect の「エフェクト割当」から
    「DepthMapRT」タブを選んで、掛けたくないオブジェクトの適用エフェクトを
    DepthMap.fx から Exclusion.fx へ選びなおすことで行うことで実現できます。

■ 権利、免責等
　このエフェクトファイルの利用に関しての制限や改変等にたいする制限は一切ありません。
　このエフェクトを使用したことによって起きたすべての損害等について、作者及び関係者は一切責任を負わないものとします。
　全て各利用者の責任の元に利用、改変等を行ってください。

■ 謝辞
　このエフェクトは mqdl さんの好意により再配布を行っております。ありがとうございます。
　このエフェクトは 舞力介入P、そぼろP、ビームマンPのソースコードを参考にさせていただいております。
　このエフェクトは monsho の解説、および配布ソースコードを参考にさせていただいております。
　このエフェクトの MikuMikuMoving 対応化にあたり Mogg さんの SSAO_MMM を参考にさせていただいております。

■ 更新履歴
v0.5a - 12 / 08 / 17
・MikuMikuMoving V1.1.2.0 のエフェクトパラメータ欄で bool 型に対応したので差し替え
・MikuMikuEffect x64 版に置いて technique 名が被ると言うバグが顕在化してたので修正
＊MMM と AMD Radeon HD との組み合わせに置いて解像度が下がるという不具合が有ります

v0.5 - 12 / 08 / 03（人柱版）
・MikuMikuMoving に対応するためのコードを追加
　―　Mogg さんが mqdl さんの SSAO ver 0.0.0.3 をベースに対応化したと思われる SSAO_MMM を参考にしました。
　　　自分の WinVista x86 + Radeon HD6850 と MMM 1.1.0.3 では SSAO_MMM も含めて解像度の低下という不具合が有ります。

v0.4 - 12 / 02 / 08
・SSAO エフェクトを除外するための機能を追加
　―　自分が使っていた SSAO ver 0.0.0.3 では DepthMap を特定モデルだけ解除すれば問題なかったのですが
　　　現行バージョンでは同じ操作だとおかしくなるので実現するための fx ファイルを同梱しました。

v0.3 - 12 / 02 / 06
・o_SSAO の初期値を微調整。
　―　今までに比べて薄めになりますが、太もも部分の SSAO 影が床に落ちるなどの不具合を減らしました。
・o_SSAO 高品質版（HQ）を追加。
　―　ボカシ処理やエッジ判定処理などを処理が重くなるのを覚悟で出来るだけ正確に行うように変更しました。
　　―　今まで奥行きが異なっていても同じ方向を向いていると影が混ざっていたのが解消されます。
　　―　隣接した別の非エッジ部分同士の SSAO 影が混ざってしまう現象が解消されます。
　―　エッジ判定を正確に行うとエッジ部分がガタガタになってしまうので滑らかになるよう AA 処理を追加で行っております。

v0.2 - 12 / 01 / 27
・SSAOの処理をオリジナルの ver 0.0.0.4 相当に変更。
　―　少し重くなりますが画面端でも正しくSSAOが描画されるようになります。
・深度マップを参照し遠距離にあるアクセサリ（スカイドーム等）にSSAOが描写されないよう変更。
　―　これにより近景の SSAO がスカイドームなどに落ちないようになります。
・ボカシ処理を行うスクリーンサイズを小さくすることで演算量減少。
　―　少し速くなる上に、エッジ近辺のエイリアスが減少します。

v0.1a - 12 / 01 / 13
・ステージとスカイドームが近かった場合にスカイドームに影が落ちてしまうため、対症療法としてスカイドームを除外。
　―　アクセサリ名が「skydome」か「スカイドーム」で始まる場合は SSAO が描写されません。ご注意ください。

v0.1 - 12 / 01 / 13（限定テスト公開版）
・拙作エフェクトの背景透明対応改造に合わせて mqdl さんの SSAO を改変。
　―　透明対応以外にも自分の好みに合わせて初期値などを変更しています。
・動画中にエフェクトの効果を変更できるようにアクセサリ操作に対応。
　―　要望をだせば mqdl さんの本家版でも対応してくれる可能性があるそうです。