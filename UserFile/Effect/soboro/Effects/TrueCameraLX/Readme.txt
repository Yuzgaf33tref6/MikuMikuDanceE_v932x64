----------------------------------------------------------------

　　　　　　　　　　カメラ光学系統合エフェクト
　　　　　　　　　　　TrueCameraLX  Ver.3.2

　　　　　　　　　　　　　製作：そぼろ

----------------------------------------------------------------


TrueCameraの進化版として、AutoLuminous、MotionBlur2、XDOFを
ベースに統合したエフェクトです。
現実のカメラの光学的効果を簡易的にではありますが再現します。
とてつもなく重いです。

それぞれ単体で使用した場合と比較すると、発光にもブラーやDOFが
ちゃんとかかるという利点があります。

各機能のより詳しい情報はそれぞれのエフェクトのReadmeを参照してください。
使用頻度の低そうな機能のいくつかは削除されていますのでご注意ください。


■ 動作環境　---------------------------------------------------

シェーダモデル3.0および
浮動小数点テクスチャのミップマップをサポートする
グラフィックボード（DX10世代以降、VRAM1GB以上を推奨）

MikuMikuEffect 0.27 およびそれが動作する MikuMikuDance
MikuMikuEffect x64 0.32 および MikuMikuDance x64
MikuMikuMoving 1.1.8.0 以降

テスト環境：
　Win7 x64 + Phenom II X6 + GTS450
　Win7 x64 + Core i7 2677M + Intel HD Garphic


■ 使い方　-----------------------------------------------------

□ 読み込み　--------------------------------

(1)LightSampling.x を読み込む
　　※MikuMikuMoving では使用しないでください
　　※ほかのポストエフェクトを併用しない場合LightSampling.xは不要です。
　　　詳細は後述の「LightSampling」および「エフェクトの並び順」をご覧ください

(2)TrueCameraLX.x を読み込む
　　※MikuMikuMoving の場合 TrueCameraLX.fx

(3)TCLX_Focus.x を読み込む
　　※被写界深度を使用しない場合不要です


□ 被写界深度操作　　------------------------

ピント合わせにはオートフォーカスとマニュアルフォーカスが選択できます。

TCLX_Focus.x を読み込むと、TCLX_Focus.xの存在する位置にピントが合います。
ピントを合わせたい箇所に取り付けて使用します。

TCLX_Focus.x のY回転を0以外の値にすると、マニュアルフォーカスモードになります。
TCLX_Focus.x のY座標高さがピントの合う距離になります。
Y回転はボーン取り付けによる回転は反映されず、数値入力のみ使われます。
Y座標高さはボーン取り付けによる高さが反映されるため、
ダミーボーンに取り付けて使用することもできます。

TCLX_Focus.x のSi値、Tr値を操作することで
ぼかしの強さを増減することができます。

Si値を大きくすると、単純にぼかしの強さが大きくなります。
Tr値を小さくすると、被写界深度を浅くするような処理が行われます。

また、表示/非表示を切り替えることでDOFのオンオフを
切り替えることができます。


□ モーションブラー操作　--------------------

今のところ、モーションブラーで操作する要素はありません。
調整したい場合は直接エフェクトを編集します。


□ AutoLuminous操作　------------------------

TrueCameraLX.x のアクセサリのSiや位置角度で操作します。
操作はAutoLuminousと同じです。

以下、AutoLuminousのReadmeより転載。


・Si: 発光強度

発光部分の光の強さを指定します。

・Tr: ぼかし強度

発光部分のぼかしの強さを指定します。
大きくすることはできません。
これは、もともとのぼかし強度がかなり大きく設定されているためです。
それでも大きくしたい場合はエフェクトの直接編集が必要です。

--------------------------

・X: 光芒方向数

グレアの伸びる方向の数を指定します。
1方向あたり、反対方向にも光が伸びることに注意してください。
例えば、3を指定すると6本の光芒が伸びることになります。
適正値は 0〜9 程度です。
数を増やすほど負荷が増えることに注意してください。
また、増やすと意図したものより明るくなる場合があります。

・Y: 元画面輝度

元スクリーン画面の明るさを増減させます。
適正範囲は -100〜100 程度です。
-100にすると元スクリーンは完全に真っ黒になります。

・Z: 発光強度

値の指定方法が違うだけで、効果はSiと同じです。
適正範囲は -100〜500 程度です。
-100でSi=0と、100でSi=2と同じ効果があります。
ダミーボーンから発光強度を操作したい場合を想定しています。

--------------------------

・Rx: 光芒角度

指定した角度だけ、グレアの角度をずらします。

・Ry: 光芒長さ

グレアの長さを増減させます。
適正範囲は -100〜100 程度です。
あまり長くすると縞が現れてしまいます。

・Rz: 点滅周期

発光を点滅させます。入力した数値がそのまま秒単位での点滅周期になります。
正の数だとサイン波で、負の数だと矩形波で点滅します。
0にすると点滅は止まります。



□ 魚眼レンズ操作　--------------------------

初期状態では無効化されてます。
エフェクトを編集し、FISHEYE_ENABLEを1にすると有効化されます。

互換性のため残されていますが、上3つと違って統合の意味はあまりないので、
別途 FishEye を読み込んだほうがいいと思います。



■サポートエフェクト　--------------------------------------------------

TrueCameraLXと連携を前提にしたエフェクトが同梱されています。
場所はOptionsフォルダです。
必ずTrueCameraLXよりも描画順を前にします。
また、単体では意味を持ちません。


□ LightSampling.fx　--------------------------

LightSamplingは、画面の1を超える高輝度部分を抽出して
TrueCameraLXに渡すエフェクトです。

HDR機能を使用するときのエフェクトの適用順の自由度を高めます。

TrueCameraLXより前にHDR未対応のポストエフェクトが存在しない場合、
LightSamplingを使う必要はありません。

Siで高輝度部分の発光強度を、Trで高輝度部分とみなす閾値を指定できます。


□ AfterGlow.fx　--------------------------

残光を発生させます。通常の発光とは独立しています。
このエフェクトを読み込むとAG_Emitterタブが追加され、
そこでAL_Object.fxsubを適用、または好きな材質を「解除」すると
指定した箇所が発光し、残光が残るようになります。

AL_Object.fxsubを適用する場合、標準の発光と2重になってしまうので
AL_Emitter側ではAL_BlackMask.fxsubを指定するようにしてください。

Siで減衰率、Trで残光部分のみの発光強度を指定できます。
XYZで光の流れのオフセットを、RxRyRzで光のゆらぎを指定できます。


□ AL_BlackMask.fxsub　--------------------------

AL_Emitterタブ上でこのエフェクトを適用すると
そのモデルの発光を停止できます。


■ エフェクトの並び順　-----------------------------------------

TrueCameraLXはポストエフェクトです。
また、AutoLuinousと同じHDRエンジンを使用しているため、
他のポストエフェクトとの前後関係には多少複雑な制約があります。

TrueCameraLXでは、以下のようなエフェクトの並び順を推奨しています。


・AfterGlow
　　　↓
・HDR対応ポストエフェクト、加算合成系のポストエフェクト（SpotLight、PointLightなど）
　　　↓
・LightSampling
　　　↓
・HDR未対応のポストエフェクト（Diffusion、SSAOなど）
　　　↓
・TrueCameraLX
　　　↓
・ほかのポストエフェクトの影響を受けたくないポストエフェクト（字幕など）


他のポストエフェクトをHDR対応させたい場合、
たいていはエフェクトコード中の「A8R8G8B8」を「A16B16G16R16F」に
置き換えればOKです。
ただし、ビデオメモリをより多く消費し、重くなります。


■ Cloneエフェクトとの連携　------------------------------------

従来のTrueCameraはCloneで増やしたモデルには効果が適用されませんでしたが、
このエフェクトは比較的容易にCloneとの連携が可能になっています。

(1) 好みに配置に編集したClone Ver.4.0以上を用意し、モデルに適用します。

(2) クローンエフェクトと同じフォルダに AL_Object.fxsub と TCLXObject.fxsubを
　　コピーします。

(3) コピーした AL_Object と TCLXObject を開いて
　　　「//#include "Clone.fx"」の部分を
　　　「#include "(クローンエフェクトのファイル名)"」のように変更します。

(4) MMEのAL_EmitterタブおよびDVMapDrawタブから、適用されている
　　AL_Object および TCLXObject をコピーした方に置き換えます。
　　（fxsubファイルを適用するには、ファイルを開くダイアログから
　　　「全てのファイル」を選択します）

(5) クローンにもDOFや発光が適用されます。

※間違ってオリジナルのAL_Object と TCLXObjectを編集しないでください。



■ オプション　-------------------------------------------------

背景が黒くなってしまうのが嫌な方向けに白背景.xを同梱してます。
中身は白色の巨大なドームです。

他、AutoLuminousと同じオプションもいくつか同梱されています。


■ 注意事項　---------------------------------------------------

・このエフェクトは複数読み込みを想定していませんので避けてください。
・26万頂点を超えるPMXファイルには対応していません。
・MikuMikuMovingでは、以下の制限があります。
　・アクセサリの移動についてブラーがかかりません。


■ 更新履歴　---------------------------------------------------

Ver.3.2
・AutoLuminous機能を4.0準拠にバージョンアップ

Ver.3.1
・LightSamplingのSiが効いてないバグ修正

Ver.3.0
・AutoLuminous機能を3.5準拠にバージョンアップ
・Clone連携機能を若干変更し、ダミー同梱を廃止
・ラインブラーに関する深刻なバグ修正

Ver.2.3
・発光部分が飛び出す問題修正
（AL_Object.fxsub のPOPUP_LIGHTを1にするとこれまでと同じになります）
・材質モーフによる発光強度変更に対応（色変更は未対応）

Ver.2.2
・XML同梱

Ver.2.1
・バグ修正

Ver.2.0
・MMM対応
・DOF操作方法変更
・DOF計算式を大幅変更
　・手前側のボケを強調
　・遠方のボケを緩和

Ver.1.2
・バグ修正

Ver.1.1
・AfterGlow追加
・バグ修正

Ver.1.0
・微調整の上、正式公開

Ver.0.3
・Clone連携機能
・バグ修正

Ver.0.2
・MikuMikuMoving対応
・バグ修正

Ver.0.1
・β版公開


■ 利用条件　---------------------------------------------------

商用利用、改変、再配布を含むいかなる利用も自由です。
また、作者の許諾も不要です。
ただし、このエフェクトを利用したことによるどのような損害も
責任を負うことはできません。自己責任でご利用ください。

mylist:  http://www.nicovideo.jp/mylist/17392230
twitter: sovoro_mmd

