
XDOF Ver.2.2
そぼろ式 新・被写界深度エフェクト

製作：そぼろ


奥にピントが合っているときの手前側の物体の輪郭が
クキッリとしてしまい不自然になるという
SvDOFの欠点を改善した新式DOFです。
使い方はSvDOFと変わりません。


●必要環境

・MME 0.27以降
・シェーダモデル3.0および浮動小数点テクスチャをサポートするグラフィックボード

テスト環境：Win7 x64 + Phenom II X6 + GTS450


●更新履歴

Ver.2.3
・MME0.30で動作しないバグ修正

Ver.2.2
・リミッタが正常に働いていないバグ修正
・コード整理

Ver.2.0
・ぼかしの強い領域と弱い領域の境界のにじみを改善
・高品質DOFモードの無意味化により削除
・余分な処理を削除

Ver.1.2
・サンプル数を増やすとぼかし強度も変わってしまう問題修正

Ver.1.1
・手前のぼかしと奥側のぼかしが重なった部分が不自然になる問題解消
・高品質DOFモードをデフォルトではOFFに

Ver.1.0
・公開


●使い方

・XDOF.xを読み込みます。
・XDOF.xをピントを合わせたい箇所のボーンに関連付けます。
・Siでぼかし強度を調整します。


ピントは基本的にXDOF.xの存在する位置で合います。
細かく調整するときはMMEをオフにすると、どこにあるか分かりやすくなります。
Si値でぼかし強度を調整できます。
初期設定は強めになっているので好みに調整してください。

Tr値を変更すると、合焦距離は XDOF.xまでの距離 * Tr値 になります。
ただしこの方法ではピントを奥にはずらせないので、
XDOF.xそのものを移動させるかManualFocusを使います。


●ManualFocus.x

ManualFocus.xを読み込むと、オートフォーカスが無効になり、
ManualFocus.xの Si の値でフォーカス調整を行うようになります。
デフォルトの合焦距離は35です。

ManualFocus.x自体はただの透明な板です。単独では使えません。


●パラメータ

・Extent
　ぼかし範囲を設定します。Siで調整できるのであまり変更の必要はないかもしれません。

・BlurLimit
　ぼかし量を制限するリミッターです。

・ClearColor
　背景色です。
　白くしたい時は1,1,1,1に。

・SAMP_NUM
　ぼかしに使われる一方向あたりのサンプリング数を設定します。
　大きくするとぼかしがきれいになりますが、あまり大きな数値を入れると
　グラボがクラッシュしかねませんので、fpsと相談しながら少しづつ大きくしてみてください。

・DOF_Shallow_LOOP
　手前側ぼかしで使用されるループ回数です。
　大きくするとぼかし強度の変化がスムーズになりますが重くなります。
　特に理由がなければそのままにしてください。


以下は "XDOF_DepthOut.fx" のパラメータです。

・TransparentThreshold
　透過させるためのアルファ値の閾値です。
　この値よりアルファ値の小さい部分は透過され、その背景の情報に基づいてブラーがかかります。

・TRANS_TEXTURE
　透明素材の透過にテクスチャのアルファ値を使用するオプションです。
　1で有効、0で無効になります。

・DepthLimit
　XDOF_DepthOut.fx側にあるパラメータです。遠方のぼかしが際限なく大きくなってしまうのを
　防ぐためのリミッターです。もっと激しい遠方のぼかしが好みであれば大きくしてみてください。


●免責
いかなる利用も自由ですが、自己責任でお願いします


