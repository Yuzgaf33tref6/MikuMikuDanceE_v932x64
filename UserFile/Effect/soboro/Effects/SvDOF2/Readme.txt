
SvDOF Ver.2.0
そぼろ式 被写界深度エフェクト

製作：そぼろ


既存のDOFの欠点を改善した独自DOFです。より実際のカメラに近い表現ができます。
次のような特徴があります。
・ピントのあったモデルの周囲に色のにじみがありません。
・深度によりぼかし範囲が変わります。
・合焦距離によって被写界深度が変わります。対象に接近すると被写界深度は浅くなります。
・視野角を小さくすると（＝ズームにすると）ぼかしが大きくなります。
・サンプリング数の変更が可能で、高速環境では、より品質の高いぼかしが得られます。

ただし、エッジが少し汚くなり、周囲がわずかに歪みます。
また、奥側のぼかしに比べて、手前側のぼかしは元の領域をはみ出せない
関係上、いまいちリアリティに欠けます。

まあ、光学的にはうそをついているので仕方ないです。


●必要環境

・MME 0.23以降
・シェーダモデル3.0および浮動小数点テクスチャをサポートするグラフィックボード

テスト環境：Win7 x64 + Phenom II X6 + GTS450


●更新履歴

Ver.2.0
・透明素材を透過できるように
・SvDOF_HQ.fx を追加

Ver.1.2
・大型ステージ使用時のクオリティアップ

Ver.1.1
・SvDOF.x のTr値で合焦距離をある程度調整できるように
・ダミーアクセサリを変更し、MMEをオフにしたときに見やすく
・用語訂正　焦点距離→合焦距離　細かいことですが…


●使い方

・SvDOF.xを読み込みます。
・SvDOF.xをピントを合わせたい箇所のボーンに関連付けます。
・Siでぼかし強度を調整します。


ピントは基本的にSvDOF.xの存在する位置で合います。
細かく調整するときはMMEをオフにすると、どこにあるか分かりやすくなります。
Si値でぼかし強度を調整できます。
初期設定はかなり強めになっているので好みに調整してください。

Tr値を変更すると、合焦距離は SvDOF.xまでの距離 * Tr値 になります。
ただしこの方法ではピントを奥にはずらせないので、
SvDOF.xそのものを移動させるかManualFocusを使います。


●SvDOF_HQ.fx

動作速度を度外視して品質を追求した高画質版です。使い方は同じです。
極めて重いです。主に静止画をターゲットとしています。
最近のハイエンドGPUをお持ちの方であれば動画にも使用できる可能性があります。


●ManualFocus.x

ManualFocus.xを読み込むと、オートフォーカスが無効になり、
ManualFocus.xの Si の値でフォーカス調整を行うようになります。
デフォルトの合焦距離は35です。

ManualFocus.x自体はただの透明な板です。単独では使えません。


●パラメータ

・Extent
　ぼかし範囲を設定します。Siで調整できるのであまり変更の必要はないかもしれません。

・SAMP_NUM
　一方向あたりのサンプリング数を設定します。
　大きくするとぼかしがきれいになりますが、あまり大きな数値を入れると
　グラボがクラッシュしかねませんので、fpsと相談しながら少しづつ大きくしてみてください。

・BlurLimit
　ぼかし量を制限するリミッターです。

・DepthLimit
　SvDOF_DepthOut.fx側にあるパラメータです。遠方のぼかしが際限なく大きくなってしまうのを
　防ぐためのリミッターです。もっと激しい遠方のぼかしが好みであれば大きくしてみてください。


以下は "SvDOF_DepthOut.fx" のパラメータです。

・TransparentThreshold
　透過させるためのアルファ値の閾値です。
　この値よりアルファ値の小さい部分は透過され、その背景の情報に基づいてブラーがかかります。

・TRANS_TEXTURE
　透明素材の透過にテクスチャのアルファ値を使用するオプションです。
　1で有効、0で無効になります。
　重くなるのを防ぐためにデフォルトでは無効になっているのでご注意ください。


●免責
いかなる利用も自由ですが、自己責任でお願いします


