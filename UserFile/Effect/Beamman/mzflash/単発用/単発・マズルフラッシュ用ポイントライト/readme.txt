■PointLight(点光源)テスト用エフェクト(by 極北P)

○使い方

1. "PointLightモデルアクセ(改名配置)用.fx" を対象のモデル用に改名配置(必要分全て)
2. PointLight1.x を追加 (.fxと間違えないように。落ちる場合は3.と追加順序を入れ替える)
3. 1.のモデル／アクセサリを追加
4. MMDの[背景]-[アクセサリ編集]からPointLight1の描画順をモデルの前に変更("0番目より〜"の番号を増加させる)

5. 初期状態は光量が0なので色設定
→PointLight1.x の Rx,Ry,Rz を RGBに見立てて色設定 (例:Rx(R):1,Ry(G):1,Rz(B):1 -> 白(1,1,1))

※追加時不定期にMMDが落ちる場合があります(原因不明)。同様に環境によっては使用できない可能性があります。


○使い方＋

・ダミーボーンを追加→PointLight1.xへダミーボーン接続 (光源の任意移動)
・PointLight2.x 以降の追加 (追加後は要描画順序の変更／色設定)

※同じ照明アクセは追加不可(MMEの仕様)


○説明

簡単な点光源（のようなもの）です。色と位置の設定だけでもなんとなく使えるかと思います。

反面、色計算式は単純な数値加算でしかないので、非常にいい加減な作りになっています(Toonとの調整も未設定)

通常の方向ライトと同様、遮蔽物の向こう側も照明対象となるのでご注意を。
また性質上セルフシャドウとも相性が悪いです。

あくまでテスト用に作成したものなので、そういうものとしてご利用ください。

※被写界深度エフェクトなどとの共用はMMD／MME側のverUP状況などと鑑みつつ検討（エフェクト内の対象部分を移植すれば現時点でも共用などは可能です）


○エフェクトパラメータ解説

・アクセサリ

表示　　　　　：照明のON／OFF
位置(X,Y,Z)   ：照明位置 ※移動はダミーボーン推奨
回転(Rx,Ry,Rz)：色(RGB)設定 (各値は0-1 ※範囲外も一応入力可能)
サイズ(Si)    ：照明の強さ

※アクセの"影"をONにすると不正な影が表示されることがあるのでOFF(未チェック)のままにしておくこと
※接続したダミーボーンの回転で色を連続的に変化させることも一応可能(非推奨／特定の角度で不正な計算結果になる)


・モデルエフェクト

// 個別の色設定有効 (true:アクセの回転値で色指定／false:白で固定)
static bool PL_ColorChange = true;
→
false で強制的に白設定

// 減衰係数 = cf.w / ( cf.x + cf.y*d + cf.z*d^2 )
// d:光源との距離
static float4 PL1_Cf = float4(0,1,0,1);   // x,y,z,w -> cf = 1/d
static float4 PL2_Cf = float4(0,1,0,1);
static float4 PL3_Cf = float4(0,1,0,1);
static float4 PL4_Cf = float4(0,1,0,1);
→
照明の減衰係数の設定

// 光源の強度 (負数設定で減色効果も可能)
static float PL1_Power = 1;
static float PL2_Power = 1;
static float PL3_Power = 1;
static float PL4_Power = 1;
→
照明の強さ
負数設定で減色照明とすることも可能

※負数設定は(-1,-1,-1)など回転値を使った色設定でも可能


・照明エフェクト

// 照明ポイントの表示
static bool Draw = false;
→
true にすると照明オブジェクトを表示 (映像出力時は要非表示化 =false)



○というわけで

またつまらないものを(ry


・なんか落ちるんですけど？
原因不明です。すぐに再現することもあれば、時間を置いたら再現しなくなることもあります。

・真っ暗から点光源の照明つけたら酷いことに･･･
色計算が一度0(黒)になってから強制的に加算しているのでそうなります。内部の計算式上対応は難しい？

・複数の点光源付けたらすぐに真っ白に･･･
加算量が増えるので必然的に最大値の白に飽和しやすくなります。強度などを適宜変更してください。

・光源4つじゃ足りないんだけど？
処理は単純な加算式なので追加は容易です。エフェクト内を書き換えましょう。

・照明パラメータがモデル側エフェクトにあるので一々全部変更するのが大変！
ポストエフェクトや別アクセからの多重設定など対応方法は考えられますが、
その分煩雑になるので、現時点ではMMD／MME側のverUP待ちとなります。

・色計算適当すぎ！
さーせん

・エフェクト内に必要ない処理が(ryバグが(ry
修正よろしくです。

・改変／再配布は？
基本的にご自由に。ただし商用利用についてはご遠慮願います。
尚、本エフェクトはMME標準エフェクトを改変しているので、そちらの規約も合わせて参照ください。



○お約束
自己責任でのご利用を。



○修正
シェーダモデル3.0／2.0に専用化。3.0が動かない環境の場合は"SM20"フォルダ以下のFXファイルを使用すること。


