HgDOF.fx v0.0.5

PowerDOFを改造し、実用性を無視してより高品位を追求した被写界深度エフェクト、かなり重いです。
後ぼけはPowerDOFとほぼ同じですが、前ボケには異なる手法を使っています。
奥にピントが合っている状態で手前のモデルによる前ボケのにじみが重なっても
ピントが合っている方はボケることがありません。より現実に近い前ボケになっています。
また、ピントがあったモデルのジャギーを取り除くために、MLAA法によるアンチエイリアシング処理が行えます。


・動作環境
SM3.0+VTF対応グラフィックボードが必須になります。
またMMEv0.24以降でないと正しく動作しません。


・基本的な使用方法
(1)HgDOF.xをMMDにロードしてください。
(2)ピントはHgDOF.xのアクセ位置で合うようになっています。
   ぼかし強度や被写界深度(ピントが合う範囲)はカメラと被写体位置との距離や視野角で自動調整されます(光学的には正しくないですが)。
(3)必要に応じてHgDOF.fxの先頭パラメータを変更してください。
(4)MMDでHgDOF.xのアクセサリパラメータから以下の変更が可能です。
   Si：ぼかしの強度
   Tr：前ボケのぼかし調整（モデル位置やカメラアングルで前ボケが少し強めに掛かることがあります。
                           ここを下げて後ボケとのバランス調整を行います。）


・オートフォーカスの使用方法
(1)HgDOF_AutoFocus.xをMMDにロードすると(デフォルトでは)画面の中心にあるモデルの深度に自動でピントが合います。
   カメラの向きを変えるとピントはすぐに合わずに、(ホームビデオカメラで撮影したように)遅延で徐々に合っていきます。
(2)MMDでHgDOF_AutoFocus.xのアクセサリパラメータから以下の変更が可能です。
   表示：オートフォーカスのon/off
   XY：画面のフォーカスする位置補正(画面中心が0で画面端が-1,+1になります)
   Rx：オートフォーカス遅延焦点移動の弾性度( -100.0 〜 +100.0 ぐらいで調整)
   Ry：オートフォーカス遅延焦点移動の抵抗度( -20.0 〜 +20.0 ぐらいで調整)


・MikuMikuMovingについて
このエフェクトはMikuMikuMovingにも対応しています。
HgDOF.fxを直接MikuMikuMovingにロードしてご利用下さい。
なおMMMでは HgDOF_AutoFocus.x は描画順序を HgDOF.x の前にしないと正常に動きません。


※画面ピクセル数が1048576以上になると正しく描画出来なくなります(大体1260*720ぐらいまで)。

※前ボケを作る仕組みは、描画するすべてのピクセルに板ポリゴンを並べて、ボケの強さに応じて拡大させ
  周囲のピクセルに加算させるという力業です。
  ボケの原理そのものをシミュレートした手法といえるので現実に近いぼかしを再現できるのですが、強いぼかしを掛けたり、
  画面上で前ボケの占める面積が大きいとGPUに過大な負荷が掛かるため超絶に重くなります。
  場合によってはMMDごと落ちることもあるのでご注意ください。


・MLAA処理について
ピントのあったモデルの後ろ側で色のにじみを抑えるぼかし処理を施すと、
MMDのアンチエイリアスが無効化されジャギーが発生してしまいます。
そこで、このエフェクトではジャギーを取り除くためにMorphological Antialiasing(MLAA)法を用いた
ポストエフェクトによるアンチエイリアシング処理を行っています(その分重くなりました)。
MLAA処理のon/offはHgDOF.fxの先頭パラメータで変更可能です。


・更新履歴
v0.0.5  2014/04/02   内部コードの整理、前ボケ境界部の再調整
                     MMMでパラメータスイッチMODE_HQが1では汚くなる不具合の解消
v0.0.4  2013/07/01   オートフォーカスの改良
                     MMMの動的パース対応他、細かい修正
v0.0.3  2012/10/20   MMMでの調整&不具合修正
v0.0.2  2012/10/10   MLAA処理の追加
v0.0.1  2012/10/09   初回版公開


・免責事項
ご利用・改変・二次配布は自由にやっていただいてかまいません。連絡も不要です。
ただしこれらの行為は全て自己責任でやってください。
このプログラム使用により、いかなる損害が生じた場合でも当方は一切の責任を負いません。


by 針金P
Twitter : @HariganeP


