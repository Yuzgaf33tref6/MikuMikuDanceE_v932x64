HgSpotLight.fx v0.0.1

独自のスポットライト光源エフェクトです。


・動作環境
SM3.0対応グラフィックボードが必須になります。
MMEv0.37, MMEv0.37x64で動作確認を行っています。旧バージョンでは動作しない可能性があります。


・基本的な使用方法
(1)HgSpotLight.pmxをMMDにロードしてください。
   MMMではHgSpotLight.fxとHgSpotLight.pmxを両方ロード、描画順を必ずHgSpotLight.pmx→HgSpotLight.fxとなるようにして下さい。
(2)HgSpotLight.pmx に パラメータ初期化.vmd をロードして表情バーの位置を初期化します。
   (MMDでは一度フレーム移動しないと表情バーの位置が変化しません)
(3)HgSpotLight.pmxのボーン・表情バーのそれぞれの項目で以下の制御が可能です(MMMもこれで調整)。
   [ボーン]
     光源位置：ボーン座標がライトの光源位置になります。
     照射方向：このボーンがある方向にスポット照射されます。外部親にアサインするとモデル追従に出来ます。
               (後述の鈍化追従ボーンを利用すると、より自然なモデル追従が出来ます。)
   [表情バー]
     目  ：光量 → 光源の明るさ調整
           光源径 → 光源の大きさ調整(光源ボリュームを考慮した処理になっています。ただしライティング自体は点光源処理)
           FVL〜 → 後述のボリュームライト表現用のパラメータです。
     ﾘｯﾌﾟ：照射距離 → 光の届く範囲の調整
           照射角 → スポット照射の角度調整
           照射縁階調 → スポット照射縁側のグラデーション調整
     まゆ：赤色,緑色,青色 → 光源の色(RGBで調整)
     その他：散乱光 → 光の当たっていない部位の明るさ調整
             影ぼかし,影濃度 → セルフシャドウの調整
             トーン描画度 → モデルライティング描画で陰影の調整
(4)HgSpotLight.fxの先頭パラメータを必要に応じて適宜変更して下さい。
(5)HgSpotLight.pmx(MMMはHgSpotLight.fxも)は複数ロードしてそれぞれ個別の設定が可能です。


・セルフシャドウなし版について
セルフシャドウ描画が必要ない場合は｢セルフシャドウなし｣フォルダにあるエフェクト一式を使用した方が動作が軽くなります。
操作方法はセルフシャドウあり版と同じです。


・アクセサリ版について
MMDの描画順序の関係でどうしてもアクセサリの描画順にしなければならない時は｢MMEアクセ版｣フォルダ内のエフェクト一式を使用します。
MMMでは描画順をモデルとアクセ共に自由に変更出来るので、こちらを使うメリットがなく対応はしません。
   基本的な使用方法
   (1) HgSpotLight.x をMMDにロードしてください。
   (2) HgSpotLight.x のアクセサリパラメータで以下の制御が可能です。
        X,Y,Z : 光源位置（ボーンにアサインしてもOK）
        Rx,Ry,Ry : スポット照射方向の調整（ボーンにアサインしてもOK）
        Si : 光源の明るさ調整
   (3) その他のパラメータについては HgSpotLight.fx, HgSL_Object.fxsub, HgSL_ShadowMap.fxsub の先頭パラメータで対応して下さい。


・ボリュームライト表現について
｢おまけ\疑似ボリュームライト｣フォルダにある FakeVolumeLight エフェクトを利用することで疑似的ですがスポットライトに
連動したボリュームライト表現が出来るようになります。
   使用方法
   (1) FVL_Obj.pmx をMMDにロードして、描画順を HgSpotLight.pmx の直後にします。MMMはこの行程は不要です。
   (2) FakeVolumeLight.x をMMDにロード(MMMではFakeVolumeLight.fxをロード)して下さい。これでセットしてある
       全てのHgSpotLightにボリューム光線が描画され、スポットライトの操作に連動します。
   (3) HgSpotLight.pmx の表情バーのそれぞれの項目で以下の制御が可能です(MMMもこれで調整)。
         FVL光量 → 光線の明るさ調整
         FVL光源量 → 光源描画の明るさ調整(スポット内で光源を見ている時に発光します)
         FVL長さ → 光線の長さ調整
         FVL長さ*10 → 光線の長さ調整(10倍変化)
         FVL減衰率 → 光線の距離に応じた明るさの減衰調整
         FVLランダム → 大きくすると光芒が鮮明になる
   (4) FakeVolumeLight.x のアクセサリパラメータで以下の制御が可能です。
         Si : ボリュームライトのぼかし度
         Tr : ボリュームライトの合成比
       MMMでは FakeVolumeLight.fx のエフェクトプロパティで同様の操作ができます。
   (5)必要に応じて FVL_Object.fxsub(MMMではFVL_ObjectMMM.fxsub) の先頭パラメータを適宜変更して下さい。
   ※ボリュームライトを使用する場合は HgSpotLight.pmx の描画順は出来るだけ後ろにあった方が都合が良いと思います。
   ※AutoLuminousを併用すると光源の発光がより綺麗になります。描画順はFakeVolumeLight.xをAutoLuminousの前にして下さい。


・鈍化追従ボーンについて
｢おまけ\鈍化追従ボーン｣フォルダにあるPMXモデルを用いると、ボーン追従の動きを緩和させ
小刻みな動きに反応しなくなります。MMDの物理演算機能を使ったギミックのダミーボーンモデルです。
HgSpotLight.pmx の｢照射方向｣ボーンと追従させるモデルの間に連結させることでスポットライト照射方向を、
より自然でスムーズなモデル追従にさせることが出来ます。
   使用方法
   (1)鈍化追従ボーン?.pmx をMMDにロードしてください。
       ※剛体・ジョイントのパラメータの異なる以下の2種類のPMXモデルを用意しましたので条件の良い方をロードしてください。
          鈍化追従ボーン1.pmx : 汎用的なバランスを考慮した調整、小刻みな動きに多少は反応します。動きの激しいモデル向け。
          鈍化追従ボーン2.pmx : かなりの鈍化追従ですがスポット照射の動きが自然になるよう調整。動きが静かなモデル向け。
   (2)鈍化追従ボーン.pmx の｢センター｣ボーンを追従させたいモデルのボーンに外部親登録します。
   (3)HgSpotLight.pmx の｢照射方向｣ボーンを 鈍化追従ボーン.pmx の｢鈍化追従｣ボーンに外部親登録します。
   (4)MMDの物理演算はONにして下さい。これでHgSpotLightはモデルの動きに対してスムーズなスポット照射を行います。
  ※普通のPMXモデルですので、本エフェクト以外のモデルに対する鈍化追従にも対応できます。


・Lat式モデルの対応について
このエフェクトではPMD・PMXモデルについてもライティング処理としてフォンシェードを採用しているため
Lat式モデルに適用するとフェイス部がとんでもない描画になってしまいます(Lat式モデルのフェイス部は特殊なデータ構造で
MMDのトーンシェードにしか対応していないため)。
そこで特別措置として｢おまけ\Lat式モデル対応｣フォルダにあるエフェクトを適用することでこの問題を回避出来ます。
   使用方法
   (1)｢おまけ\Lat式モデル対応｣フォルダにある中で使用条件に合うフォルダ内のHgSL_ObjectLat.fxsub(MMMではHgSL_ObjectLatMMM.fxm)の
      先頭パラメータで、Lat式モデルのフェイス材質番号リストを記述します。
      デフォルトでは Lat式ミクVer2.31_Normal.pmd に合わせているので使用モデルによって材質を調べて書き換える必要があります。
   (2)HgSL_ObjectLat.fxsub(MMMではHgSL_ObjectLatMMM.fxm)をオフスクリーンタブ｢HgSL_DrawRT｣にあるLat式モデルを選択して適用します。


・その他
(1)｢おまけ\BlackOut｣フォルダにあるBlackOut.x(MMMではBlackOut.fx)をロードすると、画面が暗転するので
   ライティングの調整がしやすくなります。Trで暗転度を変更出来ます。
   使用の際には必ずBlackOut.xの描画順を先頭にして下さい。
(2)セルフシャドウあり版では条件によってはモデル輪郭部にちらつきが発生することがあります。
   その際にはMLAA(自作)やo_DLAA(おたもん氏)の併用をオススメします。


・更新履歴
v0.0.1  2014/04/7   初回版公開


・免責事項
ご利用・改変・二次配布は自由にやっていただいてかまいません。連絡も不要です。
ただしこれらの行為は全て自己責任でやってください。
このプログラム使用により、いかなる損害が生じた場合でも当方は一切の責任を負いません。


by 針金P
Twitter : @HariganeP


