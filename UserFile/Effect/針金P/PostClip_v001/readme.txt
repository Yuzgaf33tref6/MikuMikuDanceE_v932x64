PostClip ver0.0.1

既存のポストエフェクトを指定領域でクリップして、エフェクトを掛ける範囲を制限します。
ポストエフェクトであればどのエフェクトでも対応可能です。
クリップの方法は単純な領域指定だけでなく、深度や法線などMMDの3D情報に応じてクリップ
することも可能、かつ複数のクリップ方式を論理集合のように合成することも出来るので
応用次第で様々な表現に使えるのでないかと思います。


■動作環境
MMEv0.37, MMEv0.37x64で動作確認を行っています。旧バージョンでは動作しない可能性があります。



■基本的な使用方法 (すでに既存のポストエフェクトがロードされているとします)

(1)まずは PreClip.x をMMDにロードしてください。このエフェクトは必須です。

(2)次に PostClip～.x の内、クリップの種類に応じて必要なエフェクトをロードします。一度に複数のロードも可です。
   クリップの種類はファイル名に応じて以下のようになっています。
     PostClip_Mask     : マスク画像を利用したクリップ
     PostClip_Obj      : モデルの形状に応じたクリップ
     PostClip_ColorKey : カラーキーを用いたクリップ
     PostClip_Bright   : スクリーン輝度に応じたクリップ
     PostClip_Depth    : モデルの深度に応じたクリップ
     PostClip_Distance : 指定位置から一定距離をクリップ
     PostClip_Height   : モデルの高さに応じたクリップ
     PostClip_Normal   : モデルの法線に応じたクリップ

(3)クリップしたいポストエフェクトを描画順序で PreClip.x と PostClip～.x の間に挟みます。
    例)描画順を次のようにするとポストエフェクトB,ポストエフェクトCがクリップの対象になります。
       ポストエフェクトA
       PreClip
       ポストエフェクトB
       ポストエフェクトC
       PostClip_Obj
       ポストエフェクトD

(4)PostClip～.x のアクセサリ操作で X=1 にするとクリップが実行されます(X=0は後述の論理合成で使用)。



■各クリップの操作方法

  PostClip～.xについては共通パラメータとしてMMDのアクセサリ操作から以下の変更が可能です。
      X,Y,Z : 複数のクリップで論理合成を行います(後述)
      Tr：このクリップの掛かり具合

  その他のパラメータについては各クリップ固有の操作になります。

(1)PostClip_Maskについて
   ①PostClip_Mask.fxの先頭パラメータでマスク画像のファイル名を指定してください。
     マスク画像は吉里吉里のトランジションライブラリ等が使いやすいです(http://kikyou.info/tvp/)。
   ②MMDのアクセサリ操作から以下の変更が可能です。
     Rx = 0:マスク画像に応じたフェードイン,フェードアウトが出来ます。
     Rx = 1:マスク画像の濃度がそのままクリップ範囲になります。
     Si：(0～1)値が小さいとフェードの変化がシャープで大きいとマイルドになります。
     Tr : Rx=0 の時はフェードの進行度，0でクリップ無し，1で全クリップ

(2)PostClip_Objについて
   ①｢MMEffect｣→｢エフェクト割当｣のPC_ObjRTタブよりクリップしたいモデルを選択して PC_Object.fx を適用します。

(3)PostClip_ColorKeyについて
   ①PostClip_ColorKey.fxの先頭パラメータでカラーキーの閾値を指定してください(MMEのみ,MMMはエフェクトプロパティで変更)。
   ②MMDのアクセサリ操作から以下の変更が可能です。
     Rx,Ry,Rz : それぞれ カラーキーのR,G,B色(0～1)に対応しています。
     Si：閾値周りのクリップ度、大きいとマイルドになり小さいとシャープなクリップになります。

(4)PostClip_Brightについて
   ①MMDのアクセサリ操作から以下の変更が可能です。
     Rx : 輝度の閾値オフセット(-1～+1)(クリップする輝度の範囲が変わります)。
     Si：閾値周りのクリップ度、大きいとマイルドになり小さいとシャープなクリップになります。

(5)PostClip_Depthについて
   ①MMDのアクセサリ操作から以下の変更が可能です。
     Rx : クリップし終わる前方の深度
     Ry : クリップを開始する後方の深度

(6)PostClip_Distanceについて
   ①MMDに PC_DistanceOrg.x をロードしてください。クリップする範囲はこのアクセ座標からの距離で決まります。
     MMMの場合は PostClip_Distance.x の座標からの距離で決まるのでこの行程は必要ありません。
   ②MMDのアクセサリ操作から以下の変更が可能です。
     Rx : クリップ形状、OFF:アクセ座標から全方位同じ距離(球形)でクリップ, ON:アクセ座標から等水平距離(円柱形)でクリップ
     Ry : クリップ境界の階調長さ
     Si : クリップする距離

(7)PostClip_Heightについて
   ①MMDのアクセサリ操作から以下の変更が可能です。
     Rx : クリップを開始する下方の高さ
     Ry : クリップし終わる上方の高さ

(8)PostClip_Normalについて
   ①PostClip_Normal.fxの先頭パラメータを必要に応じて適宜変更します(MMEのみ,MMMはエフェクトプロパティで変更)。
   ②MMDのアクセサリ操作から以下の変更が可能です。
     Rx,Ry,Rz : クリップする法線ベクトルの回転角(初期値は真上方向)
     Si：閾値周りのクリップ度、大きいとマイルドになり小さいとシャープなクリップになります。



■クリップの論理合成について
このエフェクトでは複数のクリップ方式を組み合わて、論理集合のようにクリップする範囲を合成するこで、
複雑なクリップ範囲指定が可能です。

PostClip～.xについて、クリップ合成に必要な共通パラメータとしてMMDのアクセサリ操作から以下の変更が可能です。
(MMEのみ,MMMはエフェクトプロパティで変更)。

      X = 0:ここではクリップを実行せず後のクリップの合成に使う, 1:クリップを実行する。
          (複数のクリップを組み合わせるには最後のクリップだけ1で、他は0します)
      Y = 0:前のクリップとの論理和合成になる, 1:前のクリップとの論理積合成になる。
          (最初のクリップについては空集合との合成,すなわち0でこのクリップを行い1でクリップしなくなる)
      Z = このクリップの反転(論理否定)

    例)次のような描画順とパラメータ指定では、PostClip_DepthとPostClip_Obj反転の論理積(PostClip_Depthで
       深度によるクリップをした中でPostClip_Objで指定したモデルだけがクリップされない)になります。

       PreClip
       ポストエフェクトA
       ポストエフェクトB
       PostClip_Depth   ←X=0,Y=0,Z=0
       PostClip_Obj     ←X=1,Y=1,Z=1



■MikuMikuMovingについて
このエフェクトはMikuMikuMovingにも対応しています。
PreClip.fx及び各PostClip～.fxを直接MikuMikuMovingにロードしてご利用下さい。
各パラメータはMMMのエフェクトプロパティより変更が可能です。
PostClip_Obj.fx のオフクリーンタブではクリップしたいモデルに PC_ObjectMMM.fx を適用してください。



■更新履歴
v0.0.1  2014/4/7   初回版公開


■免責事項
ご利用・改変・二次配布は自由にやっていただいてかまいません。連絡も不要です。
ただしこれらの行為は全て自己責任でやってください。
このプログラム使用により、いかなる損害が生じた場合でも当方は一切の責任を負いません。


by 針金P
Twitter : @HariganeP


