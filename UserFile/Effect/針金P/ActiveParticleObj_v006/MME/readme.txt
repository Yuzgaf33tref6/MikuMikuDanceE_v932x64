ActiveParticleObj.fx ver0.0.6

オブジェクトが移動に応じて粒子化した複製モデルを放出します．
オブジェクトの移動量に応じて放出される粒子の数と放出位置が調整されるので,オブジェクトを
どのように動かしてもまんべんなく粒子が広がります．
ActiveParticle.fxを元に既存のモデルを粒子オブジェクトとして扱えるようにしました。


・使用方法
(1)ActiveParticleObj.xをMMDにロードしてください．
   同じ名前のxファイルを複数ロードすると正常に動作しなくなるので注意してください。
   複数の粒子オブジェクトを用いたい場合はファイル名に連番の付いた別xファイルをロードする必要があります。
   (デフォルトでは0〜3を用意,新たに増やしたい場合はx,fxファイルを新しい連番でコピーしてfxの先頭パラメータの所定箇所も更新)
(2)粒子化するモデルにParticle_Object.fxを適用してください．
    GUIの場合｢MMEffect｣→｢エフェクト割当｣のメインタブより適用したいオブジェクトにParticle_Object.fxを割り当てる.
    ファイル名設定の場合：XXXXX.pmd から XXXXX[Particle_Object.fx].pmd に変更，または Particle_Object.fx を XXXXX.fx に変更してロード．
    複数の粒子オブジェクトを用いる場合はファイル名の対応する連番fxファイルを適用する必要があります．
(3)ActiveParticleObj.xを適当なボーンに付けて動かすと,動きに合わせて粒子が描画されます．
   ※注：粒子化するモデルはボーンに付けないで下さい、正常に描画出来なくなります．
(4)必要に応じてfxファイルの先頭パラメータを変更してください．
(5)MMDのActiveParticleObj.xのアクセサリパラメータで以下の変更が可能です．
    Si：粒子の放出量
    Tr：粒子の透過度


・背景移動演出時の利用方法ついて
オブジェクトの動きを表現する場合、直接オブジェクトを動かす以外に、背景の方を移動させてオブジェクトが
動いているように見せるような演出がよく使われます。
同梱のBackgroundControl.xを用いるとオブジェクトを動かさなくても、背景の動きに連動して粒子を放出させることが出来ます。
(1)OptionフォルダにあるBackgroundControl.xをMMDにロードしてください。アクセ自体は表示されません。
(2)BackgroundControl.xを背景モデルを移動させるボーンに共に付けてください。
(3)このボーンを動かすと粒子の動きはボーンの位置・角度を基準にした座標系に切り替わり、
   オブジェクトとの相対的な位置関係でオブジェクトの移動量を計算して粒子を放出します。


・時間コントロールの方法ついて
同梱のTimeControl.xを用いると粒子の運動に対する時間の流れを遅くしたり、停止させたりできます。
スローモーションの演出や、静止画の出力などに便利です。
(1)OptionフォルダにあるTimeControl.xをMMDにロードしてください。アクセ自体は表示されません。
(2)TimeControl.xのアクセサリパラメータで以下の変更が可能です。
    Si：0にするとフレームを移動させた時だけ時間が流れます。静止画出力の時にご利用下さい。
    Tr：時間の進行度、0にすると停止します。
  ※モニターより大きいサイズでの出力はうまく行かない場合があります。


・AutoLuminous対応モデルについて
オプションとしてAutoLuminous4(そぼろ氏作)用のセレクタを作成しましたのでAL_Optionフォルダにある
対応するセレクタファイルを粒子化モデルに適用してください．
・AutoLuminous対応モデルの場合：｢MMEffect｣→｢エフェクト割当｣のAL_EmitterRTタブから粒子化モデルを指定して、AL_Object_ParticleObj.fxを割り当てる．
・ObjectLuminous方式の場合：｢MMEffect｣→｢エフェクト割当｣のAL_EmitterRTタブから粒子化モデルを指定して、OL_Selector_ParticleObj.fxを割り当てる．
                            こちらはObjectLuminous,CrossLuminousでも使用可です.fx内パラメータは必要に応じて変更してください．
・AutoLuminousのマスク機能を使う場合：｢MMEffect｣→｢エフェクト割当｣のAL_MaskRTタブから粒子化モデルを指定して、Particle_Object.fxを割り当てる．
(詳しい使用方法はAutoLuminous,ObjectLuminousのReadme.txt参照)．
これらの発光エフェクトと併用する場合は、粒子化モデルの描画順序をActiveParticleObj.xよりも前に設定してください．でないとモデルと発光描画の位置が
ずれることがあります．



・注意点
一度に描画される粒子の数は最大で4096です．これ以上の粒子を発生させるような状況になると
発生中の粒子が消失するまで新たな粒子を放出しなくなります．

粒子化するモデルはデータサイズの小さいものを使ってください。モデルによっては劇重になります。
Particle_Object.fxの先頭パラメータで指定した複製数が実際に描画される粒子の数になります(最大で4096まで)。

複製モデルがPMDの場合エッジは独自描画になります．デフォルトでは全ての頂点に対してエッジ描画するようになっています．
PMDの材質でエッジoff設定にしているところまでエッジを描くので，正確に描画するにはモデルごとにエッジの材質指定をする必要があります．
PMDEditorでエッジを描画している材質を確認してからParticle_Object.fxの先頭パラメータで描画する材質を指定してください．
材質指定方法は以下のように記述します．<MMEffectのREFERENCE.txtより抜粋>
　　"0,3,5"のように、カンマ区切りで番号を列挙することで、複数の番号を指定できる。
　　また、"6-10"などのように、番号をハイフンでつなぐことで、範囲指定ができる。
　　"12-"のように、範囲の開始番号のみを指定した場合は、それ以降の全ての番号が対象となる。

※このFXファイルをMMEで使用するにはVTF(Vertex Texture Fetch)対応のSM3.0グラフィックボードが必須になります．
また、MME ver0.33以降でないと正しく動作しません。


・更新履歴
v0.0.6  2014/5/20   BackgroundControl.x追加、背景を移動させてオブジェクトが動いているように見せる演出でも使えるようにした
                    時間コントロールの制御アクセTimeControl.x追加
                    内部コードの整理
v0.0.5  2013/6/20   粒子発生・消失アルゴリズムの改良
                    モデル複製エフェクトをMME最新バージョン(v0.35)仕様にした(PMXの材質モーフ､サブTex等に対応)。
                    AutoLuminous4の対応
                    MikuMikuMoving版の追加
v0.0.4  2012/9/10   x64版の対応、パラメータ更新時に表示がおかしくなるバグ修正
                    粒子発生アルゴリズムを一部変更,AutoLuminous2.0の対応
v0.0.3  2011/11/20  粒子発生･挙動アルゴリズムの改良,発生位置のムラを軽減
                    相対速度設定を廃止して重力設定,流体場設定追加,AutoLuminousの対応
v0.0.2  2011/10/2   相対速度設定(止まっていても粒子放出可)追加,ObjectLuminous用セレクタ追加
v0.0.1  2011/9/27   初回版は非公開


・免責事項
ご利用・改変・二次配布は自由にやっていただいてかまいません。連絡も不要です。
ただしこれらの行為は全て自己責任でやってください。
このプログラム使用により、いかなる損害が生じた場合でも当方は一切の責任を負いません。


by 針金P
Twitter : @HariganeP

