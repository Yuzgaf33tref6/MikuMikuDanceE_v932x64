

ikPostFog

任意の方向にフォグを掛けるポストエフェクト


■ 使い方

	(0. 適当なステージデータを読み込む。)
		※ 背景やスカイドーム、モデルがないとエフェクトの効果が出ません。

	1. ikPostFog.pmx をMMDに入れる。
	2. 表情モーフから、加算のR,G,Bをいずれか0より大きくして、フォグに色をつける。
		カメラが原点付近にあって、ステージなどで隠されなければ、下から上へのグラデが表示されます。

	3. モーフの「深さ+」や「厚さ+」などを調整してみる。
	4. ikPostFog.pmx の 角度や位置を変えてみる。

	(5. MMEのPostFogNormalMapRTタブから、余計なもののチェックを外す。)


	回転させない状態では、"すべての親"を中心にフォグ濃度が上(+Y)方向に薄く、
	下(-Y)方向に濃くなります。
	上下方向の幅は、「深さ+」「深さ-」でコントロールできます。

	奥行き(Z)方向のフォグの厚さを「厚さ+」「厚さ-」でコントロールできます。
	左右(X)方向のフォグの厚さは「幅+」「幅-」でコントロールできます。

	pmxを回転させることで、フォグの向きを変更できます。


■ 設定項目

モーフで設定する項目

	全体拡大
		フォグのサイズを全体的に大きくする。

	深さ+、深さ-
		フォグの高さを制御する。深いほどフォグのグラデが長くなる。
		ローカル空間でのY軸(＝MMDの画面右下にLOCALと表示されている状態で、モデルに表示される緑の軸)に沿って、フォグの濃度は薄くなる。

		深さはフォグ全体の濃度にも影響を与える。伸ばすほどフォグ全体が薄くなる。
		内容そのままで引き伸ばすために、全体が薄まる。

	幅+、幅-
		X軸方向のフォグの厚みを制御する。

	厚さ+、厚さ-
		Z軸方向のフォグの厚みを制御する。

		幅と厚みはフォグ濃度全体に影響しないが、視線がフォグ内を通る距離が長くなれば、その分、フォグは濃くなる。

	濃度+、濃度-
		フォグの濃さを制御する

	エリア限定
		フォグ範囲の奥にもフォグの影響を与えるかどうか。

		視線→フォグ→フォグエリア外
			のような場合、エリア限定=0の時、フォグエリア外もフォグの影響を受ける。
			フォグエリア外へのフォグの影響を弱めたい場合、この値を大きくする。


	加算R,G,B
		フォグが濃いほど、ここで指定した色を加算する。

	減衰R,G,B
		フォグが濃いほど、元画像からここで指定した色を減算する。
		より正確には、元画像の色 * (1 - 減衰色)となる。


	ライトR,G,B
		ライト方向のフォグの色を指定。
		ライトとカメラの角度に応じて、加算R,G,Bの色がここで指定した色に変化する。

	ライト強度
		この値が大きいほどライト色の影響を受ける。0で無効。

	ライト範囲
		この値が大きいほどライト色の範囲が大きくなる。
		ただし、最大にしてもライトの逆方向を向いている場合はライトの影響を受けない。


	フェード
		エフェクト全体の効果を下げる。

	テストモード
		設定した色とは無関係にフォグの掛かる度合いを表示する。
		フォグの掛かる部分を白、ライト色の影響を受ける部分を黄色で表示する。

		テストモードで画面上部に表示される色は、
		上から順に、加算色、(1 - 減衰色)、ライト色を示す。
		左から右にいくにつれてフォグ濃度が高い状態での色となる。
		ライト色はライト強度に応じて、加算色と合成される。
			ライト強度が0の場合、ライト色は加算色と等しい。

		複数のフォグエフェクトを使用する場合、他のポストエフェクトを使う場合、
		それらに影響を受けて、色が変化することがある。


■ ファイルの内容

	ikPostFog.pmx
		エフェクト本体。

		ikPostFog.fx
			ikPostFog.pmx 用のエフェクトファイル。マイナーな設定項目がいくつかある。
		ikPostFog.fxsub
			エフェクトファイルの共通部分。
			HLSLを直接弄りたい人以外は放置推奨。

		ikNormalMap.fx
			画面の奥行きを調べるエフェクト。基本的には触る必要なし。
		ikNormalMapMask.fx
			フォグの影響を受けたくないモデル・材質に対してikNormalMap.fxの代わりに使用する。
			MMEのPostFogNormalMapRTタブに設定する。

	ikPostFogSub.pmx
		複数使う場合のサブエフェクト

		ikPostFog.pmxの計算結果を借用することで、省メモリ・高速化している。
		このため、ikPostFog.pmx と同時に使用する必要がある。

		ikPostFogSub.fx
			ikPostFogSub.pmx 用の設定ファイル

	ikPostFogAcs.x
		アクセサリ版のエフェクト
		描画順序の問題や、親を指定して移動させたい場合などpmxを使いたくない場合用。

		ikPostFogAcs.fx
			ikPostFogAcs.x 用の設定ファイル

		ikPostFogController.pmx
			ikPostFogAcs.x 用のコントローラ


■ 注意点

	距離を基準にフォグを計算しているため、遠距離ではフォグが歪みます。

	モデル編集モードとカメラ編集モード(動画作成時)でライト色の見え方が異なる場合があります。
	MMDのモデル編集モードでモーフを動かす際、メニューでカメラ・照明追従を有効にしないと、
	ライトの向きがデフォルト位置にリセットされているためです。



■ 使用、再配布に関して

	エフェクトの利用、改造、再配布などについては自由に行ってもらってかまいません、連絡も不要です。

	このエフェクトを使用したことによって起きたすべての損害等について、作者及び関係者は一切責任を負わないものとします。



■ 更新履歴

	2015/02/11 Ver 0.01		初公開

ikeno
@ikeno_mmd

