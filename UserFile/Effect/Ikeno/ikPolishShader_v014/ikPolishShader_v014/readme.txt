
ikPolishShader

--------------------------------------------------------------------------------
■ 概要

　ikPolishShaderはPBR(物理ベースレンダリング)風のシェーダーです。
　素材特性をあらわすパラメータを元に、周囲の物体を映りこませることで
　立体感と素材感を出すことができます。

　このドキュメントでは最低限の使い方だけを説明しています。
　必要に応じて、readme_detail.txtをお読みください。

　以下のURLで使い方を簡単に説明しています。
　　 http://www.nicovideo.jp/watch/sm27733338


--------------------------------------------------------------------------------
■ 目次
・使用方法
・トラブルシューティング
・使用、再配布に関して
・更新履歴


--------------------------------------------------------------------------------
■ 使用方法

□ 最低限必要な設定

　0. モデルを読み込む。
　　※ できるだけスカイドームや背景モデルを読み込んでください。

　1. MMDに ikPolishShader.x を追加する。

　2. アクセサリの位置を調整する。
　　初期状態ではアクセサリが地面に埋まっているので、(0, 15, 0)など、適当な位置に調整します。
　　この位置を中心に映り込み用の画像を生成します。

　3. MMEのエフェクト割り当てを開き、
　3-1. Mainタブで、モデルやステージなどに Main/PolishMain.fx を割り当てる。
　　スカイドームは通常のままにしたほうがよいです。

　3-2. EnvMapタブで、モデルに映りこんで欲しくないものを除外します。
　　メインのモデルは除外したほうがよいです。
　　※ .pmx, .pmdはデフォルトで環境マップから外すようにしました。
　　　 .pmxタイプの背景モデルなど、必要に応じて TEnvMap.fxを指定してください。

　3-3. EnvMapタブで、スカイドームに対して、TEnvMap_emissive.fxを割り当てる。


--------------------------------------------------------------------------------
■ トラブルシューティング

　重い
　　→ readme_detail.txtの「軽量化のために」を読んで、軽い設定にしてみる。


　暗い
　　・光の当たっている場所が暗い
　　→ MMDのライトで調整する。
　　　 ikPolishController.pmxを入れて、直接光+で明るくする。

　　・光の当たっていない場所が暗い
　　→ EnvMapタブのスカイドームにTEnvMap_emissive.fxが割り当てられているか調べる。
　　　 ikPolishController.pmxを入れて、間接光+で明るくする。
　　　 スカイドームを明るいものに変える。

　　・顔に髪の影が乗る
　　→ ShadowMapRTタブの顔の材質に、Shadow_distance.fxsub を割り当てる。


　縁の部分がズレる。細い線が変に表示される。
　→ 
　　MMDのメニュー>表示>アンチエイリアスをオフにすると改善される場合があります。
　　　※アンチエイリアスの設定はMMDを立ち上げるたびに無効にする必要があります。
　　大きくレンダリングして縮小して誤魔化す。


　金属なのに映り込まない。
　→
　　材質の反射色の問題：
　　・PMXエディタを開いて材質をチェックする。
　　　スペキュラカラー(鏡面反射色)が黒くないか調べる。
　　　暗い場合は、(0.5,0.5,0.5)以上の値にする。

　　材質の滑らかさの問題：
　　・MaterialMapの ENABLE_AUTO_SMOOTHNESS をコメントアウトして、直接Smoothnessを変更してみる。
　　　または、材質マップでSmoothnessを設定する。
　　　※ 材質の反射強度が小さいほど、Smoothnessが小さいほどハイライトや映り込みが暗くなります。

　　映りこむ側の問題：
　　・ikPolishShader.xの位置を調べる。地面に埋まっていると、映り込み画像が正しく作成できない。
　　・周囲に映り込むものがない → スカイドームをおくか、静的な環境マップを利用する。



--------------------------------------------------------------------------------
■ 使用、再配布に関して

　エフェクトの利用、改造、再配布などについては自由に行ってもらってかまいません、連絡も不要です。
　このエフェクトを使用したことによって起きたすべての損害等について、作者及び関係者は一切責任を負わないものとします。


--------------------------------------------------------------------------------
■ 更新履歴

　2016/08/27 Ver 0.14
　　・映り込み、肌表現の計算方式を変更。他調整。

　2016/06/26 Ver 0.13
　　・太陽光の反射をサポート
　　　 → ikPolishShader.fxsub内のRSMCountを0で無効。
　　・シャドウマップの影をボカさないモードをつけた。(デフォルト無効)
　　　 → ikPolishShader.fxsub内のENABLE_HARD_SHADOWを1で有効。
　　・環境マップを八面体にした
　　　 → ikPolishShader.fxsub内のUSE_OCTAHEDRONを0で従来通り。
　　・各種処理の見直し。
　　(・Matreials関連は Ver0.09以降から互換性があります)

　2016/04/26 Ver 0.12
　　・映り込みのノイズを軽減

　2016/04/20 Ver 0.11
　　・スフィアマップも法線マップの影響を受けるようにした。
　　・SSAOの精度を上げるオプションを追加。
　　・環境マップの生成に失敗することがあった不具合を修正
　　・環境マップからデフォルトでキャラを除外

　2016/01/06 Ver 0.10a
　　・ライト色が正しくなかった不具合を修正

　2015/12/28 Ver 0.10
　　・Metalnessの扱いを修正
　　・映り込みの修正

　2015/12/05 Ver 0.09
　　・補助ライト対応
　　・顔用に髪の毛の影が落ちないシャドウマップ設定を追加
　　・肌の透明感表現を追加
　　・簡易環境マップを削除
　　・SSGIの処理をSSDOに変更
　　・その他、細かい調整。

　2015/08/16 Ver 0.08
　　・映り込みの精度を上げた。
　　・SSAOの計算を修正。
　　・シャドウマップの描画を高速にした。
　　・その他、細かい調整。

　2015/05/12 Ver 0.07
　　・GI風の新しい映り込み機能を追加
　　・SSAO、その他の修正
　　・最適化。

　2015/04/29 Ver 0.06
　　・アンチエイリアス機能の追加。
　　・映り込み計算の調整

　2015/03/31 Ver 0.05
　　・SSSを材質指定可能にした。
　　　材質マップのアルファチャンネルでSSS度を指定可能にした。
　　　Mainのエフェクトで、肌用の色味設定をできるようにした。
　　・ExcellentShadowの統合。
　　・上記にともないいくつかの処理を整理。

　2015/03/18 パッチ
　　・材質マップを要素毎に指定できるようにした。

　2015/03/11 Ver 0.04
　　・環境マップの作成方法見直し
　　　ikPolishShader.fx内のUSE_SIMPLE_ENVMAPをコメントアウトすることで使用可能です。
　　・映り込み計算の簡略化
　　・肌の計算方法の簡略化

　2015/02/28 Ver 0.03
　　・コントローラ対応。全体の明るさを調整する機能を追加。
　　　これに伴いライト強度に関連したパラメータを削除。
　　・自己発光色(環境色)の扱いを変更した。
　　　PMXeで環境色となっている項は、MMD上は自己発光色として扱われる。
　　　ライトなど本当に光る素材以外は、暗闇で明るくなり過ぎるため、
　　　デフォルトでは自己発光色を環境色として扱うように変更した。
　　・映り込みの計算で一部ミスがあったのを修正。その他各種計算の見直し。
　　・NCHLモード時に、スペキュラカラーを無視するようにした。
　　　NCHL対応モデルではスペキュラカラーに各種材質設定を格納するため。
　　・環境マップ作成時にスフィアマップを無視できるようにした。

　2015/02/22 Ver 0.02
　　・静的環境マップに対応。
　　・色計算を微調整。
　　・複数材質の一括指定対応。
　　・readmeを修正。

　2015/02/20 Ver 0.01
　　・初公開


ikeno
Twitter: @ikeno_mmd
